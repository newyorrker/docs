(function(){"use strict";var e={4418:function(e,t,s){var r=s(538),i=s(6234),o=s(1251),n=s(7995),a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"app"}},[e.isApplicationCreate?t("application-create"):e.id?t("application-detail",{attrs:{id:e.id}}):t("applications-list")],1)},l=[],c=s(655),p=s(140),u=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"documents-list"},[e.showNewApplicationButton?t("button",{on:{click:e.goToApplicationsCreate}},[e._v("Add new")]):e._e(),t("easy-refresh",{ref:"easyRefresh",staticClass:"documents-list__refresh",class:{"documents-list__refresh_error":e.isError},attrs:{"on-refresh":e.refresh,loadMore:e.loadMore,autoLoad:!0,userSelect:"false",showScrollBar:!0},scopedSlots:e._u([{key:"header",fn:function(){return[t("ClassicsHeader",{attrs:{finishDuration:0,refreshedText:"",refreshingText:e.$t("common.refreshingText"),refreshText:e.$t("common.pullToRefreshPrompt"),refreshReadyText:e.$t("common.releaseToRefreshPrompt")}})]},proxy:!0},{key:"footer",fn:function(){return[t("EmptyFooter")]},proxy:!0},{key:"scrollbar",fn:function(){return[t("ClassicsScrollBar",{attrs:{color:"rgba(0, 0, 0, 0.3)",bgColor:"transparent",width:"3",radius:"2"}})]},proxy:!0}])},[e.isError?t("background-icon-error",[t("p",[e._v("При загрузке списка документов произошла ошибка")])]):[e.showList?t("div",{staticClass:"documents-list__list",class:{"documents-list__list_bordered":e.showSkel}},e._l(e.items,(function(s){return t("document-card",{key:s.id,attrs:{title:s.typeName,source:s},nativeOn:{click:function(t){return e.openItem(s)}}})})),1):e._e(),t("documents-list-skel",{directives:[{name:"show",rawName:"v-show",value:e.showSkel,expression:"showSkel"}],staticClass:"documents-list__skel"})]],2),!e.showList||e.items.length||e.showSkel||e.isError?e._e():t("div",{staticClass:"documents-list__empty"},[e._v(" Список заявлений пуст ")])],1)},d=[],h=s(6318),f=s(6981),m=s(2958),g=s(7499),v=s(1671),y=s(5423),_=s(1390),w=s(9669),S=s.n(w);class Z{constructor(e,t){(0,h.Z)(this,"queryFabric",void 0),(0,h.Z)(this,"hrLinkRepository",void 0),(0,h.Z)(this,"cancelToken",void 0),this.queryFabric=e,this.hrLinkRepository=t}async load(e){const t=this.queryFabric.getQuery(e);return this.cancelToken&&this.cancelToken.cancel(),this.cancelToken=S().CancelToken.source(),await this.hrLinkRepository.getApplications(t,{cancelToken:this.cancelToken.token})}}class I{constructor(e){(0,h.Z)(this,"pagingState",void 0),this.pagingState=e}getQuery(){const e={take:this.pagingState.take,skip:this.pagingState.skip};return e}}let b=class extends f.Z{constructor(...e){super(...e),(0,h.Z)(this,"applicationsListService",void 0)}created(){this.applicationsListService=new Z(new I(this.pagingState),this.$hrLinkRepository)}mounted(){window.clickButton=this.buttonClicked}destroyed(){window.clickButton=void 0}async getList(e=!1){this.isLoading=!0,this.resetEasyRefreshScroll(),this.pagingState.skip=e?this.items?.length??0:0;try{const t=await this.applicationsListService.load({});if(this.isError=!1,e&&this.items?this.items=[...this.items,...t]:this.items=t,t.length<this.pagingState.take)return!0}catch(t){this.isError=!0,this.$store.dispatch("reportError",t)}finally{this.isLoading=!1,this.loaded=!0}return!1}openItem(e){const t=(0,y.Rg)(this.$store.getters["platform"],{id:e.id},e.typeName);document.location.href=t}goToApplicationsCreate(){const e=(0,y.Rg)(this.$store.getters["platform"],{isApplicationCreate:"true",isTypeSelect:"true"},"Создание заявления");document.location.href=e}buttonClicked(e){e===_.Z["new"]&&this.goToApplicationsCreate()}get showNewApplicationButton(){return"Web"===this.$store.getters["platform"]}};b=(0,c.gn)([(0,p.wA)({components:{DocumentsListSkel:g.Z,DocumentCard:m.Z,BackgroundIconError:v.Z}})],b);var k=b,x=k,C=s(1001),A=(0,C.Z)(x,u,d,!1,null,null,null),L=A.exports,T=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"application-detal"},[!e.isError&&e.item?[e.isSign?t("application-sign",{attrs:{source:e.item,id:e.item.applicationGroupId,defaultErrorMessage:"При попытке подписания документа произошла ошибка"},on:{signed:e.load}}):t("application-view",{attrs:{source:e.item}})]:e.isError?t("background-icon-error",[t("p",[e._v("При загрузке документа произошла ошибка")])]):e._e()],2)},E=[],F=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"application-view"},[t("div",{staticClass:"application-view__padding"},[t("application-info",{attrs:{source:e.source}})],1),t("pdf-viewer",{staticClass:"application-view__pdf",attrs:{id:e.source.id,fileDataLoader:e.fileDataLoader,name:e.source.typeName},on:{done:function(t){e.loading=!1}}}),t("footer",{staticClass:"application-view__footer"},[t("button-1",{on:{click:e.sign}},[e._v("Подписать")])],1),e.loading?t("background-spinner"):e._e()],1)},P=[],$=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"application-info"},[e.source.creator?t("user-profile",{attrs:{userProfile:e.source.creator}}):e._e(),t("div",{staticClass:"application-info__text"},[t("p",[t("span",[e._v("Сформировано:")]),e._v(" "+e._s(e.creationDate)+" ")]),t("application-signers",{staticClass:"application-info__signers",attrs:{source:e.source}})],1)],1)},R=[],D=s(8117),U=s(7468),j=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"document-signers"},[e.approver?t("div",{staticClass:"document-signers__list"},[t("span",[e._v("Кому:")]),t("div",{staticClass:"document-signers__list-item"},[t("signer-profile",{attrs:{source:e.approver},nativeOn:{click:function(t){return e.openProfile(e.approver.profile)}}})],1)]):e._e()])},M=[],N=s(3238),O=s(1687);let B=class extends N.Z{get approver(){return{name:this.source.approver.fullName,profile:this.source.approver}}};B=(0,c.gn)([(0,p.wA)({components:{SignerProfile:O.Z}})],B);var V=B,q=V,H=(0,C.Z)(q,j,M,!1,null,null,null),G=H.exports;let K=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"source",void 0)}get creationDate(){return(0,U.p)(this.source.createdAt)}get currentUserProfile(){return this.$store.state.userProfile}};(0,c.gn)([(0,p.fI)({required:!0})],K.prototype,"source",void 0),K=(0,c.gn)([(0,p.wA)({components:{UserProfile:D.Z,ApplicationSigners:G}})],K);var z=K,J=z,Q=(0,C.Z)(J,$,R,!1,null,null,null),W=Q.exports,X=s(3686),Y=s(9097),ee=s(3437);class te{constructor(e){(0,h.Z)(this,"repository",void 0),this.repository=e}load(e){return this.repository.getApplicationFile(e)}}let se=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"source",void 0),(0,h.Z)(this,"loading",!0),(0,h.Z)(this,"fileDataLoader",new te(this.$hrLinkRepository))}sign(){const e=(0,y.Rg)(this.$store.getters["platform"],{id:this.source.applicationGroupId,isSign:"true"},this.source.typeName);document.location.href=e}};(0,c.gn)([(0,p.fI)({required:!0})],se.prototype,"source",void 0),se=(0,c.gn)([(0,p.wA)({components:{ApplicationInfo:W,PdfViewer:Y.Z,Button1:ee.Z,BackgroundSpinner:X.Z}})],se);var re=se,ie=re,oe=(0,C.Z)(ie,F,P,!1,null,null,null),ne=oe.exports,ae=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"document-sign"},[e.showMain?[t("div",{staticClass:"document-sign__container"},[t("sign-title",{attrs:{title:e.source.typeName,type:""}}),t("application-info",{attrs:{source:e.source}}),t("pin-code",{attrs:{error:e.isPinCodeError},model:{value:e.pinCodeValue,callback:function(t){e.pinCodeValue=t},expression:"pinCodeValue"}}),t("sign-troubleshooting",{attrs:{codeIsWrong:e.currentState.matches(e.State.wrongCode),canRestartSign:e.canRestartSign,time:e.time},on:{restart:e.restart}})],1),t("footer",{staticClass:"document-sign__footer"},[t("button-1",{on:{click:e.confirm}},[e._v("Подтвердить")])],1)]:e._e(),e.isBusy?t("sign-loading",{attrs:{type:"заявление",showText:e.currentState.matches(e.State.onConfirmation)}}):e._e(),e.currentState.matches(e.State.startSignError)?[t("background-icon-error",[t("p",[e._v(e._s(e.errorMessage))])]),t("footer",{staticClass:"document-sign__footer"},[t("button-1",{on:{click:e.startSign}},[e._v("Повторить попытку")])],1)]:e._e(),e.currentState.matches(e.State.confirmationError)?[t("background-icon-error",[t("p",[e._v("Ошибка! "),t("br"),e._v(" Не удалось подписать заявление")])]),t("footer",{staticClass:"document-sign__footer"},[t("button-1",{on:{click:e.confirm}},[e._v("Повторить попытку")])],1)]:e._e(),e.currentState.matches(e.State.signIsSucceed)?[t("background-icon-success",[t("p",[e._v("Вы подписали заявление!")])]),t("footer",{staticClass:"document-sign__footer"},[t("button-1",{on:{click:e.goToList}},[e._v("К списку заявлений")])],1)]:e._e()],2)},le=[],ce=s(7398),pe=s(5848),ue=s(2378),de=s(3897),he=s(2068),fe=s(7834),me=s(8295);let ge=class extends ce.Z{constructor(...e){super(...e),(0,h.Z)(this,"source",void 0)}mounted(){this.startSign()}goToList(){const e=[{type:_.Z["new"],params:{visible:!0}}],t=(0,y.Rg)(this.$store.getters["platform"],{},"Мои заявления",e);document.location.href=t}};(0,c.gn)([(0,p.fI)({required:!0})],ge.prototype,"source",void 0),ge=(0,c.gn)([(0,p.wA)({components:{ApplicationInfo:W,PinCode:pe.Z,Button1:ee.Z,BackgroundIconError:v.Z,BackgroundIconSuccess:ue.Z,BackgroundIconKey:de.Z,SignTroubleshooting:he.Z,SignTitle:fe.Z,SignLoading:me.Z}})],ge);var ve=ge,ye=ve,_e=(0,C.Z)(ye,ae,le,!1,null,null,null),we=_e.exports;let Se=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"id",void 0),(0,h.Z)(this,"item",null),(0,h.Z)(this,"isError",!1)}created(){this.load()}async load(){try{const e=await this.$hrLinkRepository.getApplication(this.id);this.item=e,this.isError=!1}catch(e){this.isError=!0}}get isSign(){return"true"===(this.$store.getters["urlParam"]("isSign")??"")}};(0,c.gn)([(0,p.fI)({required:!0})],Se.prototype,"id",void 0),Se=(0,c.gn)([(0,p.wA)({components:{ApplicationView:ne,BackgroundIconError:v.Z,ApplicationSign:we}})],Se);var Ze,Ie=Se,be=Ie,ke=(0,C.Z)(be,T,E,!1,null,null,null),xe=ke.exports,Ce=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"applications-create"},[e.isError?e._e():[t("form-group",{staticClass:"applications-create__type",attrs:{name:"Тип заявления"}},[t("select-control",{attrs:{items:e.applicationTypesList,placeholder:"Выберите тип заявления","is-loading":e.isLoading,"is-ajax":!1,"select-model":!1},model:{value:e.selectedTypeId,callback:function(t){e.selectedTypeId=t},expression:"selectedTypeId"}})],1),e.selectedTypeId?t("application-form",{staticClass:"applications-create__form",attrs:{selectedTypeId:e.selectedTypeId,mainFields:e.mainFields,systemFields:e.systemFields},on:{loading:function(t){e.isLoading=t},error:e.makeError}}):e._e()],e.isLoading?t("background-spinner"):e._e(),e.isError?[t("background-icon-error",[t("p",[e._v(e._s(e.errorMessage||"При загрузке типов заявлений произошла ошибка"))])]),t("footer",{staticClass:"applications-create__footer"},[t("button-1",{on:{click:e.retry}},[e._v("Попробовать снова")])],1)]:e._e()],2)},Ae=[],Le=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"application-form"},[e.isError?e._e():[t("div",{staticClass:"application-form__extra-controls"},[t("form-group",{attrs:{name:"Получатель заявления"}},[t("select-control",{attrs:{items:e.approversList,placeholder:"Выберите получателя","is-loading":!1,"is-ajax":!1,"select-model":!1},model:{value:e.selectedApproverUserId,callback:function(t){e.selectedApproverUserId=t},expression:"selectedApproverUserId"}}),e.errors.selectedApproverUserId?t("span",{staticClass:"form-error"},[e._v("Обязательное поле")]):e._e()],1),t("form-group",{attrs:{name:"Дата заявления"}},[t("date-input",{attrs:{needClear:!1},model:{value:e.applicationDate,callback:function(t){e.applicationDate=t},expression:"applicationDate"}})],1),e.errors.applicationDate?t("span",{staticClass:"form-error"},[e._v("Обязательное поле")]):e._e()],1),t("form",{staticClass:"application-form__form",on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)},input:e.resetFieldError}},[t("div",{staticClass:"application-form__container"},[t("form-control-list",{attrs:{fields:e.systemFields,errors:e.errors}}),t("form-control-list",{attrs:{fields:e.mainFields,errors:e.errors}})],1),t("footer",{staticClass:"application-form__footer"},[t("button-1",{attrs:{type:"submit"}},[e._v("Отправить")])],1)])]],2)},Te=[];(function(e){e["string"]="STRING",e["number"]="NUMBER",e["date"]="DATE"})(Ze||(Ze={}));var Ee=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"selector",class:{"is-active":e.active}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.active,expression:"!active"}],staticClass:"selector__label",class:{"is-placeholder":!e.selected},on:{click:e.onFocus}},[e._v(" "+e._s(e.label)+" ")]),e.active?t("input",{ref:"input",attrs:{type:"text",placeholder:e.currentPlaceholder},domProps:{value:e.search},on:{focus:e.onFocus,input:e.onSearchInput}}):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"selector__arrow",on:{click:e.onFocus}},[t("arrow")],1),e.isLoading?t("div",{staticClass:"selector__spinner"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none"}},[t("path",{attrs:{fill:"#F39420","fill-opacity":".12","fill-rule":"evenodd",d:"M12 21.818c5.422 0 9.818-4.396 9.818-9.818S17.422 2.182 12 2.182 2.182 6.578 2.182 12 6.578 21.818 12 21.818ZM12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12Z","clip-rule":"evenodd"}}),t("path",{attrs:{fill:"#F39420",d:"M12 21.818c5.422 0 9.818-4.396 9.818-9.818S17.422 2.182 12 2.182V0c6.627 0 12 5.373 12 12s-5.373 12-12 12S0 18.627 0 12h2.182c0 5.422 4.396 9.818 9.818 9.818Z"}})])]):e._e(),t("div",{staticClass:"selector__items"},[e._l(e.filteredList,(function(s){return t("div",{key:s.id,staticClass:"selector__item",class:{"is-selected":e.isSelected(s)},on:{click:function(t){return e.select(s)}}},[e._v(" "+e._s(s.title)+" ")])})),e.isLoading?e._e():[e.showNotFound?t("div",{staticClass:"selector__item is-non-selectable"},[e._v("Не найдено")]):e._e(),e.showAjaxHint?t("div",{staticClass:"selector__item is-non-selectable"},[e._v("Введите несколько символов для начала поиска")]):e._e()]],2)])},Fe=[],Pe=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("svg",{attrs:{width:"12",height:"7",viewBox:"0 0 12 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M1 1L6 6L11 1",stroke:"#8E8E93"}})])},$e=[];let Re=class extends p.w3{};Re=(0,c.gn)([p.wA],Re);var De=Re,Ue=De,je=(0,C.Z)(Ue,Pe,$e,!1,null,null,null),Me=je.exports;let Ne=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"value",void 0),(0,h.Z)(this,"placeholder",void 0),(0,h.Z)(this,"items",void 0),(0,h.Z)(this,"selectModel",void 0),(0,h.Z)(this,"disabled",void 0),(0,h.Z)(this,"isLoading",void 0),(0,h.Z)(this,"isAjax",void 0),(0,h.Z)(this,"selectField",void 0),(0,h.Z)(this,"active",!1),(0,h.Z)(this,"search",""),(0,h.Z)(this,"selected",null),(0,h.Z)(this,"blockSearchEmit",!1),(0,h.Z)(this,"previousEmitValue",""),(0,h.Z)(this,"isTyping",!1),(0,h.Z)(this,"typingTimeout",0)}get showNotFound(){return!(this.isLoading||this.isAjax&&this.isTyping)&&(this.active&&0==this.filteredList.length&&(this.search||!this.isAjax))}get showAjaxHint(){return this.active&&0==this.filteredList.length&&!this.search&&this.isAjax}mounted(){this.value&&this.setSelected()}onSearchChange(e,t){this.blockSearchEmit?this.blockSearchEmit=!1:e!=t&&this.previousEmitValue.substring(0,3)!=this.search.substring(0,3)&&(this.$emit("searchChanged",this.search),this.previousEmitValue=this.search)}get currentPlaceholder(){return this.placeholder}get label(){return this.selected&&this.selected.title?this.selected.title:this.placeholder}onValueChange(){this.setSelected()}onItemsChange(){this.setSelected()}onSearchInput(e){clearTimeout(this.typingTimeout),this.search=e.target.value,this.isTyping=!0,this.typingTimeout=setTimeout((()=>{this.isTyping=!1}),500)}get normalizedList(){return this.items.map((e=>"string"==typeof e?{id:e,title:e}:e))}get filteredList(){if(this.isAjax&&0==this.search.length)return[];const e=this.search.toLowerCase().trim().split(" ");return this.normalizedList.filter((t=>{let s=t.title.toLowerCase(),r=!0;return e.forEach((e=>{r=r&&s.indexOf(e)>=0})),r}))}setSelected(){if(this.selectModel)this.selected=this.value;else{const e=this.normalizedList.find((e=>e[this.selectField]==this.value));e&&(this.selected=e)}}isSelected(e){return this.selectModel?this.value&&this.value.id&&e.id==this.value.id:e.id==this.value}onFocus(){this.disabled||(this.active=!0,this.$nextTick((()=>{this.isAjax&&this.$refs.input&&this.$refs.input.focus()})),setTimeout((()=>{document.addEventListener("click",this.documentClick)}),500))}documentClick(e){this.isSelectorElement(e.target)||(this.blur(),document.removeEventListener("click",this.documentClick))}select(e){this.selectModel?this.$emit("input",e):this.$emit("input",e[this.selectField]),this.$emit("changed",e),this.selected=e,this.blur()}blur(){this.blockSearchEmit=!0,this.search="",this.$refs.input&&this.$refs.input.blur(),this.active=!1}isSelectorElement(e){let t=!1,s=e;while(s){if(t=s==this.$el,t)break;s=s.parentNode}return t}};(0,c.gn)([(0,p.fI)({required:!0})],Ne.prototype,"value",void 0),(0,c.gn)([(0,p.fI)({default:""})],Ne.prototype,"placeholder",void 0),(0,c.gn)([(0,p.fI)({default:()=>[]})],Ne.prototype,"items",void 0),(0,c.gn)([(0,p.fI)({default:!1})],Ne.prototype,"selectModel",void 0),(0,c.gn)([(0,p.fI)({default:!1})],Ne.prototype,"disabled",void 0),(0,c.gn)([(0,p.fI)({default:!1})],Ne.prototype,"isLoading",void 0),(0,c.gn)([(0,p.fI)({default:!1})],Ne.prototype,"isAjax",void 0),(0,c.gn)([(0,p.fI)({default:"id"})],Ne.prototype,"selectField",void 0),(0,c.gn)([(0,p.RL)("search")],Ne.prototype,"onSearchChange",null),(0,c.gn)([(0,p.RL)("value")],Ne.prototype,"onValueChange",null),(0,c.gn)([(0,p.RL)("items")],Ne.prototype,"onItemsChange",null),Ne=(0,c.gn)([(0,p.wA)({components:{Arrow:Me}})],Ne);var Oe=Ne,Be=Oe,Ve=(0,C.Z)(Be,Ee,Fe,!1,null,null,null),qe=Ve.exports,He=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"form-group"},[t("label",{attrs:{for:e.nameFor}},[e._v(e._s(e.name))]),e._t("default")],2)},Ge=[];let Ke=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"name",void 0),(0,h.Z)(this,"nameFor",void 0)}};(0,c.gn)([(0,p.fI)()],Ke.prototype,"name",void 0),(0,c.gn)([(0,p.fI)()],Ke.prototype,"nameFor",void 0),Ke=(0,c.gn)([(0,p.wA)({components:{}})],Ke);var ze=Ke,Je=ze,Qe=(0,C.Z)(Je,He,Ge,!1,null,null,null),We=Qe.exports,Xe=s(6226),Ye=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"form-control-list"},e._l(e.fields,(function(s){return t("div",{staticClass:"form-control-list__item"},[t("form-group",{attrs:{name:s.label,nameFor:s.id}},[s.type===e.FieldType.string?t("text-input",{attrs:{name:s.id}}):e._e(),s.type===e.FieldType.number?t("number-input",{attrs:{name:s.id}}):e._e(),s.type===e.FieldType.date?t("date-input",{attrs:{name:s.id,value:""}}):e._e(),e.errors[s.id]?t("span",{staticClass:"form-error"},[e._v("Обязательное поле")]):e._e()],1)],1)})),0)},et=[],tt=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("input",e._b({staticClass:"text-input",attrs:{type:"text"}},"input",e.$attrs,!1))},st=[];let rt=class extends p.w3{};rt=(0,c.gn)([(0,p.wA)({components:{}})],rt);var it=rt,ot=it,nt=(0,C.Z)(ot,tt,st,!1,null,null,null),at=nt.exports,lt=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("input",e._b({staticClass:"number-input",attrs:{inputmode:"numeric",type:"number"}},"input",e.$attrs,!1))},ct=[];let pt=class extends p.w3{};pt=(0,c.gn)([(0,p.wA)({components:{}})],pt);var ut=pt,dt=ut,ht=(0,C.Z)(dt,lt,ct,!1,null,null,null),ft=ht.exports;let mt=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"fields",void 0),(0,h.Z)(this,"errors",void 0),(0,h.Z)(this,"FieldType",Ze)}};(0,c.gn)([(0,p.fI)()],mt.prototype,"fields",void 0),(0,c.gn)([(0,p.fI)()],mt.prototype,"errors",void 0),mt=(0,c.gn)([(0,p.wA)({components:{DateInput:Xe.Z,TextInput:at,NumberInput:ft,FormGroup:We}})],mt);var gt=mt,vt=gt,yt=(0,C.Z)(vt,Ye,et,!1,null,null,null),_t=yt.exports;const wt=(e,t)=>{try{return JSON.parse(e)}catch(s){return void 0!==t?t:e}};class St{constructor(){(0,h.Z)(this,"storage",void 0),this.storage=window.localStorage}set(e,t){this.storage?.setItem(e,JSON.stringify(t))}get(e){return wt(this.storage?.getItem(e))}}var Zt=s(9490);class It{constructor(e,t,s,r){(0,h.Z)(this,"userRepository",void 0),(0,h.Z)(this,"objectRepository",void 0),(0,h.Z)(this,"localStorageClient",void 0),(0,h.Z)(this,"userId",void 0),this.userRepository=e,this.objectRepository=t,this.localStorageClient=s,this.userId=r}async getApproversList(e,t){const s=await this.userRepository.profiles({include:["firstName","lastName","middleName","userId"],where:{directionId:e},take:-1});if(!s.length)return[];const r=s.filter((e=>e.userId!==t&&e.userId)).map((e=>e.userId)),i=new Map(s.map((e=>[e.userId,e]))),o=await this.objectRepository.query("HRLinkUserSettings",{include:["userId"],where:{userId:{$in:r}},take:-1}),n=o.filter((({userId:e})=>i.has(e))).map((({userId:e})=>i.get(e))),a=n.map((e=>({id:e.userId,title:e.fullName})));return a}storeSelectedApprover(e){this.localStorageClient.set(this.getApproversLsKey(this.userId),e)}restoreSelectedApprover(e){const t=this.localStorageClient.get(this.getApproversLsKey(this.userId))||null,s=e.find((e=>e.id===t));if(s)return t}storeSystemValues(e){this.localStorageClient.set(this.getSystemFieldsLsKey(this.userId),e)}restoreSystemValues(){return this.localStorageClient.get(this.getSystemFieldsLsKey(this.userId))||null}getApproversLsKey(e){return"selected-approver-id_"+e}getSystemFieldsLsKey(e){return"saved-system-fields_"+e}}let bt=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"mainFields",void 0),(0,h.Z)(this,"systemFields",void 0),(0,h.Z)(this,"selectedTypeId",void 0),(0,h.Z)(this,"localStorageClient",new St),(0,h.Z)(this,"selectedApproverUserId",null),(0,h.Z)(this,"applicationDate",""),(0,h.Z)(this,"approversList",[]),(0,h.Z)(this,"FieldType",Ze),(0,h.Z)(this,"errors",{selectedApproverUserId:!1,applicationDate:!1}),(0,h.Z)(this,"service",null),(0,h.Z)(this,"isError",!1)}async created(){const e=this.currentUserProfile.directionId;if(e&&this.currentUserProfile.userId){this.service=new It(this.$userRepository,this.$objectRepository,this.localStorageClient,this.currentUserProfile.userId);try{this.$emit("loading",!0),this.approversList=await this.service.getApproversList(e,this.currentUserProfile.userId),this.restoreSelectedApprover()}catch(t){this.$emit("error","При загрузке дополнительных данных произошла ошибка"),this.$store.dispatch("reportError",t)}finally{this.$emit("loading",!1)}}}mounted(){this.applicationDate=Zt.ou.local().toFormat("yyyy-LL-dd"),this.restoreSystemValues()}async submit(e){const t=e.target,s=new FormData(t),r=Array.from(s.entries()),i=r.filter((e=>this.systemFieldsIds.includes(e[0]))),o=r.filter((e=>this.mainFieldsIds.includes(e[0])));this.storeSystemValues(i);const n=this.validate(r);if(!n)return;if(!this.selectedApproverUserId)throw Error("selectedApproverUserId must be set");const a=e=>({id:e[0],value:e[1]}),l=i.map(a),c=o.map(a),p={approverUserId:this.selectedApproverUserId,typeId:this.selectedTypeId,templateFields:c,templateSystemFields:l,date:this.applicationDate};try{this.$emit("loading",!0);const e=await this.$hrLinkRepository.createApplication(p);e?this.goToApplication(e):this.$emit("error","При создании заявления произошла ошибка")}catch(e){this.$emit("error","При создании заявления произошла ошибка"),this.$store.dispatch("reportError",e)}finally{this.$emit("loading",!1)}}goToApplication(e){const t=(0,y.Rg)(this.$store.getters["platform"],{id:e.applicationGroupId},e.typeName);document.location.href=t}validate(e){let t=!1;this.selectedApproverUserId&&this.applicationDate||(this.errors.selectedApproverUserId=!this.selectedApproverUserId,this.errors.applicationDate=!this.applicationDate,t=!0);for(const s of e)s[1]||(t||(t=!0),p.w3.set(this.errors,s[0],!0));return!t}resetFieldError(e){const t=e.target;this.errors[t?.name||""]=!1}storeSelectedApprover(e){this.service?.storeSelectedApprover(e)}restoreSelectedApprover(){this.selectedApproverUserId=this.service?.restoreSelectedApprover(this.approversList)||null}storeSystemValues(e){this.service?.storeSystemValues(e)}restoreSystemValues(){const e=this.service?.restoreSystemValues()||null;if(e){const t=this.$el.querySelectorAll("input"),s=Object.fromEntries(e);for(const e of t)s[e.name]&&(e.value=s[e.name])}}watchSelectedApproverUserIdHandler(e){this.storeSelectedApprover(e),this.errors.selectedApproverUserId=!1}watchApplicationDateHandler(e){}get systemFieldsIds(){return this.systemFields.map((e=>e.id))}get mainFieldsIds(){return this.mainFields.map((e=>e.id))}get currentUserProfile(){return this.$store.state.userProfile}get userId(){return this.currentUserProfile.userId}};(0,c.gn)([(0,p.fI)({default:()=>[]})],bt.prototype,"mainFields",void 0),(0,c.gn)([(0,p.fI)({default:()=>[]})],bt.prototype,"systemFields",void 0),(0,c.gn)([(0,p.fI)()],bt.prototype,"selectedTypeId",void 0),(0,c.gn)([(0,p.RL)("selectedApproverUserId")],bt.prototype,"watchSelectedApproverUserIdHandler",null),(0,c.gn)([(0,p.RL)("applicationDate")],bt.prototype,"watchApplicationDateHandler",null),bt=(0,c.gn)([(0,p.wA)({components:{Button1:ee.Z,FormControlList:_t,DateInput:Xe.Z,FormGroup:We,SelectControl:qe}})],bt);var kt=bt,xt=kt,Ct=(0,C.Z)(xt,Le,Te,!1,null,null,null),At=Ct.exports;let Lt=class extends p.w3{constructor(...e){super(...e),(0,h.Z)(this,"selectedTypeId",""),(0,h.Z)(this,"applicationTypesData",null),(0,h.Z)(this,"isLoading",!1),(0,h.Z)(this,"isError",!1),(0,h.Z)(this,"errorMessage","")}created(){this.loadTypes()}async loadTypes(){try{this.isLoading=!0,this.applicationTypesData=await this.$hrLinkRepository.getApplicationsTypes()}catch(e){this.isError=!0,this.$store.dispatch("reportError",e)}finally{this.isLoading=!1}}makeError(e){this.isError=!0,this.errorMessage=e}resetError(){this.isError=!1,this.errorMessage=""}retry(){this.resetError(),this.applicationTypesData||this.loadTypes()}get currentUserProfile(){return this.$store.state.userProfile}get applicationTypesList(){return this.applicationTypesData?.types?.filter((e=>e.templatable)).map((e=>({id:e.id,title:e.name})))||[]}get selectedType(){return this.applicationTypesData?.types.find((e=>e.id===this.selectedTypeId))}get mainFields(){return this.selectedType?.templateFields||[]}get systemFields(){return this.applicationTypesData?.templateSystemFields||[]}};Lt=(0,c.gn)([(0,p.wA)({components:{DateInput:Xe.Z,ApplicationForm:At,SelectControl:qe,FormGroup:We,BackgroundIconError:v.Z,BackgroundSpinner:X.Z,Button1:ee.Z}})],Lt);var Tt=Lt,Et=Tt,Ft=(0,C.Z)(Et,Ce,Ae,!1,null,null,null),Pt=Ft.exports;let $t=class extends p.w3{created(){const e=Object.fromEntries(new URL(window.location.toString()).searchParams.entries());this.$store.commit("setUrlParams",e)}get id(){return this.$store.getters["urlParam"]("id")??""}get isApplicationCreate(){return"true"===(this.$store.getters["urlParam"]("isApplicationCreate")??"")}};$t=(0,c.gn)([(0,p.wA)({components:{ApplicationsList:L,ApplicationCreate:Pt,ApplicationDetail:xe}})],$t);var Rt=$t,Dt=Rt,Ut=(0,C.Z)(Dt,a,l,!1,null,null,null),jt=Ut.exports;r["default"].config.productionTip=!1,r["default"].use(i.Z),r["default"].use(o.ZP);const Mt=(0,n.p)(jt,"applications");Mt.$mount("#app")},3109:function(e,t,s){s.d(t,{dx:function(){return r}});const r=()=>{void 0!=window.webkit&&void 0!=window.webkit.messageHandlers.session&&window.webkit.messageHandlers.session.postMessage("refresh"),void 0!=window.session&&window.session.postMessage("refresh")}}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,r,i,o){if(!r){var n=1/0;for(p=0;p<e.length;p++){r=e[p][0],i=e[p][1],o=e[p][2];for(var a=!0,l=0;l<r.length;l++)(!1&o||n>=o)&&Object.keys(s.O).every((function(e){return s.O[e](r[l])}))?r.splice(l--,1):(a=!1,o<n&&(n=o));if(a){e.splice(p--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[r,i,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={383:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,o,n=r[0],a=r[1],l=r[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(l)var p=l(s)}for(t&&t(r);c<n.length;c++)o=n[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(p)},r=self["webpackChunkugmk_documents"]=self["webpackChunkugmk_documents"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998,64],(function(){return s(4418)}));r=s.O(r)})();